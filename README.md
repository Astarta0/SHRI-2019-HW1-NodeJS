# SHRI-2019-HW1-NodeJS

##### Запуск:
    node index.js -p /Users/astarta0/repos
    
##### Мини-Хелп:
    node index.js -h
    
При запуске проверяется:
- что установлен git
- переданный путь до папки - абсолютный
- это действительно директория, а не файл
- если ее не существует - создается

Что использовалось:
- ExpressJS
- yargs - для разбора параметров, переданных в командной строке при запуске; для предобработки и составления help;
- rimraf - для рекурсивного удаления директорий с содержимым
- junk - отфильтровывает скрытые файлы
- body-parser - чтобы разбирать параметры в request body
- better-queue - для создания очередей (на момент написания просто установлена - еще не сделано, в TODO)

При клонировании репозитория в команду добавлен параметр GIT_TERMINAL_PROMPT=0,
как советовали [тут](https://serverfault.com/a/665959), чтобы не было ожидания пользовательского ввода при попытке склонировать несуществующий репозиторий.
Но на практике мне эту проблему не удалось воспроизвести.

Так же, хоть мы условно и приняли считать главной ветку master, я получаю имя ветки командой в методе defineMainBranchName из gitUtils.js

При запросе содержимого папки в репозитории(в ветке или по хешу, или в главной ветке), если передать путь, которого не существует, 
в ответ вернется json вида `{ "content": [] }`. Я решила пока оставить так, но можно так же вернуть и 404 ошибку.

Проблемы, при запросе оочень большого списка коммитов должна решить пагинация. Пока ее нет.

:snail: TODO:
- очередь для роутов где надо делать пулл или чекаут для получения актуального содержания
- пагинация для массива коммитов

Решила добавить --git-dir параметр в команды гита для минимизации перехода в папки (смена рабочего каталога), чтобы избежать ошибок race condition запросов

:scream: Но при таком подходе получились проблемы в роутах, где используются стримы:

    1. Роут для получения diff: если не переходить в директорию и использовать git-dir в команде для получения
       данных - получаю ошибку `"error: Could not access '4b825dc642cb6eb9a060e54bf8d69288fbee4904'\n"`. Хотя при тестировании руками - все ок.

    2. Poут для получения бинарного содержимого файла:
    при использовании --git-dir ошибка
    {"error": "fatal: not a git repository: ''/Users/astarta0/repos/differentBranchesRepository/.git''\n"}
    При тестировании руками тоже ок - выводит файл.
:exclamation: Итого, в этих роутах выполняется переход в папку репозитория, и команды, результат которых идет в стрим, выполняются как и в первой версии - без параметра --git-dir.  В коде оставлены закомментированные строки.
